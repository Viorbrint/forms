@page "/templates/fill/{templateId}"
@using Forms.Data.Entities
@using Markdig
@using Microsoft.AspNetCore.Authorization

@attribute [Authorize]

<PageTitle>Fill out the template - Forms</PageTitle>

@if (!IsLoading)
{
    <MudContainer MaxWidth="MaxWidth.Medium" Class="pa-4">
        <MudGrid Spacing="3">

            <MudItem xs="12">
                <MudImage Elevation="2" Src="@template.ImageUrl" Alt="Template Image" Style="width: 100%; aspect-ratio: 16/9; border-radius: 8px;" />
            </MudItem>

            <MudItem xs="12">
                <MudChipSet T="string" ReadOnly="true">
                    @foreach (var tag in template.Tags)
                    {
                        <MudChip Color="Color.Primary" Text="@tag"></MudChip>
                    }
                </MudChipSet>
            </MudItem>
            
            <MudItem xs="12">
                <MudPaper Class="pa-3 mb-4 d-flex justify-space-between align-center" style="width: 100%;">
                    <div class="d-flex flex-column">
                        <MudText>Topic: <MudText Typo="Typo.h5">@template.Topic</MudText></MudText>
                    </div>
                    
                    <div class="d-flex align-center">
                        <MudIconButton Icon="@Icons.Material.Filled.ThumbUp"/>
                        <MudText>12</MudText>
                        <MudIconButton Icon="@Icons.Material.Filled.Comment"/>
                        <MudText>20</MudText>
                    </div>
                </MudPaper>
            </MudItem>
            

            <MudItem xs="12">
                <MudPaper Class="pa-3 mb-4">
                    <MudText Typo="Typo.h4" Style="font-weight: bold" Align="Align.Center" Class="mb-4">@template.Title</MudText>
                    @((MarkupString)Markdown.ToHtml(template.Description))
                    @* TODO: maybe this is not safe *@
                </MudPaper>
            </MudItem>

            @foreach (var question in template.Questions)
            {
                <MudItem xs="12">
                    <MudPaper Class="pa-3 mb-4">
                        @if (question.Type == QuestionType.SingleLine)
                        {
                            <MudTextField @bind-Value="question.Answer" Label="@question.Title" Placeholder="My answer" Class="mb-3" FullWidth="true" />
                        }
                        else if (question.Type == QuestionType.MultiLine)
                        {
                            <MudTextField @bind-Value="question.Answer" Label="@question.Title" AutoGrow Placeholder="My answer" Class="mb-3" FullWidth="true" />
                        }
                        else if (question.Type == QuestionType.Number)
                        {
                            <MudNumericField T="int" @bind-Value="question.IntegerAnswer" Label="@question.Title" Placeholder="My answer" Class="mb-3" FullWidth="true" />
                        }
                        else if (question.Type == QuestionType.Boolean)
                        {
                            <MudCheckBox T="bool" @bind-Value="question.IsChecked" Label="@question.Title" />
                        }
                    </MudPaper>
                </MudItem>
            }

            <MudItem xs="12">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="SubmitForm" FullWidth="true">Submit</MudButton>
            </MudItem>

        </MudGrid>
    </MudContainer>
}
else
{
    <Loading/>
}